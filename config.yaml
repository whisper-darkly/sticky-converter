# sticky-converter â€” sticky-overseer config format
name: "sticky-converter"
listen: ":8080"
db: sticky-converter.db
trusted_cidrs: []

# Global pool defaults (overridden per-action)
task_pool:
  limit: 4
  queue:
    enabled: true
    size: 100

retry: {}

actions:
  ts-to-mp4:
    type: converter
    task_pool:
      limit: 4
    dedupe_key: ["file"]
    config:
      scan_interval: "30s"
      paths:
        - "/recordings/**/*.ts"
      direction: "oldest"
      min_age: "5m"
      delete_on_success: true
      db_path: "sticky-converter.db"
      target:
        regex: "^(?P<base>.+)\\.ts$"
        format: "{{.File.Dir}}/{{.File.Basename}}.mp4"
      command: "ffmpeg -y -i {{.Input}} -map 0:v:0 -map 0:a? -c:v libx264 -pix_fmt yuv420p -c:a copy -movflags +faststart {{.Output}}"
